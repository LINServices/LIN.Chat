@page "/transacciones"

<NavBar />

<!-- Propiedades -->
@code {

    private List<TransactionDataModel> Movimientos { get; set; } = new();

    private bool IsMovLoaded { get; set; } = false;

}


<!--Mensaje-->
@if (!LIN.Access.Developer.Session.IsOpen)
{
    <Alert Message="Debes iniciar sesion para poder acceder a tus registros" Class="warning" Svg="1" />
    return;
}



<section class="py-8 mt-5">
    <div class="container px-4 mx-auto">
        <div class="max-w-3xl mx-auto">
            <div class="flex flex-wrap -mx-4 mb-6">
                <div class="w-full md:w-1/2 px-4 mb-6 md:mb-0">
                    <div class="h-full p-6 bg-gray-200 rounded-xl">
                        <div class="flex items-center">
                            <div class="flex flex-shrink-0 self-start w-12 h-12 mr-4 items-center justify-center bg-blue-500 bg-opacity-20 text-blue-500 rounded-xl">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8.67188 14.3298C8.67188 15.6198 9.66188 16.6598 10.8919 16.6598H13.4019C14.4719 16.6598 15.3419 15.7498 15.3419 14.6298C15.3419 13.4098 14.8119 12.9798 14.0219 12.6998L9.99187 11.2998C9.20187 11.0198 8.67188 10.5898 8.67188 9.36984C8.67188 8.24984 9.54187 7.33984 10.6119 7.33984H13.1219C14.3519 7.33984 15.3419 8.37984 15.3419 9.66984" stroke="#194BFB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M12 6V18" stroke="#194BFB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#194BFB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <div>
                                <h5 class="text-xs text-slate-700 leading-6 font-semibold">Monthly Payment</h5>
                                <div class="flex items-end leading-none text-blue-500 font-semibold">
                                    <span class="text-2xl">$65</span>
                                    <span class="text-sm pb-1">/month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="w-full md:w-1/2 px-4">
                    <div class="h-full p-6 bg-gray-200 rounded-xl">
                        <div class="flex items-center">
                            <div class="flex flex-shrink-0 self-start w-12 h-12 mr-4 items-center justify-center bg-blue-500 bg-opacity-20 text-blue-500 rounded-xl">
                                <svg width="14" height="20" viewBox="0 0 14 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 9C9.20914 9 11 7.20914 11 5C11 2.79086 9.20914 1 7 1C4.79086 1 3 2.79086 3 5C3 7.20914 4.79086 9 7 9Z" stroke="#194BFB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M1 19V17C1 15.9391 1.42143 14.9217 2.17157 14.1716C2.92172 13.4214 3.93913 13 5 13H9C10.0609 13 11.0783 13.4214 11.8284 14.1716C12.5786 14.9217 13 15.9391 13 17V19" stroke="#194BFB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <div>
                                <h5 class="text-xs text-slate-700 leading-6 font-semibold">Total Clients</h5>
                                <div class="flex items-center text-2xl leading-none text-gray-600 font-semibold">
                                    <span>145</span>
                                    <span class="inline-block ml-2 py-1 px-2 text-xs text-green-800 font-medium bg-green-400 rounded-full">+12,0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-10 pt-6 pb-10 mb-6 bg-gray-200 rounded-xl">
                <div class="flex flex-wrap items-center justify-between -mx-4 mb-6">
                    <div class="w-full sm:w-auto px-4 mb-2 sm:mb-0"><h4 class="text-lg text-slate-900 font-semibold">Metodos de pago</h4></div>
                </div>
                <div class="pb-6 mb-6 border-b border-gray-400">
                    <div class="flex flex-wrap items-center justify-between -mx-4 -mb-5">
                        <div class="w-full sm:w-auto px-4 mb-5">
                            <div class="flex items-center">
                                <img class="h-12 w-17 mr-4 self-start" src="trizzle-assets/logos/visa-logo.svg" alt="">
                                <div>
                                    <h5 class="text-sm text-slate-600 leading-5 font-semibold">Visa ending in 3456</h5>
                                    <span class="text-xs text-slate-600 font-medium">Expires 04/2028</span>
                                </div>
                            </div>
                        </div>
                        <div class="w-full sm:w-auto px-4 mb-5"><a class="inline-block ml-auto px-2 py-1 text-xs leading-6 text-gray-200 font-bold bg-gray-600 hover:bg-gray-700 rounded-lg transition duration-100" href="#">Por defecto</a></div>
                    </div>
                </div>
            </div>
            <div class="p-6 mb-10 bg-gray-200 rounded-xl">
                <h4 class="text-lg text-slate-800 font-semibold mb-6">Factura</h4>
                <div class="w-full mt-6 pb-4">
                    <div class="w-full min-w-max">

                        @if (!IsMovLoaded)
                        {
                            <div class="flex w-full justify-center items-center">
                                <CircleLoader></CircleLoader>
                            </div>
                            
                        }
                        else
                        {
                            foreach (var mov in Movimientos)
                            {
                                <CreditComponent Credito="mov" />
                            }

                        }
                       
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</section>



@code {


    /// <summary>
    /// Metodo de inicio
    /// </summary>
    protected override async Task OnInitializedAsync()
    {

        // Obtiene las api Keys
        await LoadOrigins();

        // base
        await base.OnInitializedAsync();

    }


    private decimal CalculateToday()
    {

        var ac = DateTime.Now;
        var today = Movimientos.Where(T => T.Fecha.Year == ac.Year && T.Fecha.Month == ac.Month && T.Fecha.Day == ac.Day).Where(T => T.Valor < 0).Select(T => T.Valor).Sum();
        return today;
    }


    /// <summary>
    /// Carga la lista de llaves
    /// </summary>
    private async Task LoadOrigins()
    {

        IsMovLoaded = false;
        // Obtiene los dispositivos
        var result = await LIN.Access.Developer.Controllers.Profile.ReadAllAsync(LIN.Access.Developer.Session.Instance.Informacion.ID);

        if (result.Response == Responses.Success)
        {
            IsMovLoaded = true;
            Movimientos = result.Models;
            base.StateHasChanged();
        }

    }



  


}
