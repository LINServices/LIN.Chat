@page "/history"

@inject IJSRuntime js
@inject NavigationManager nav


@if (!Access.Developer.Session.IsAccountOpen)
{
    nav.NavigateTo("/login");
    return;
}

<NavBar />


@code {

    bool loadLogs = false;
    List<LoginLogModel> Logs = new();

}



@code {


    private int Count { get; set; } = 0;

    protected override async Task OnInitializedAsync()
    {

        //  var count = await LIN.Access.Controllers.Contact.Count(LIN.Access.Developer.Session.Instance.Token);
        //    Count = count.Model;

        LoadLogs();

        await base.OnInitializedAsync();
    }


    async void LoadLogs()
    {
        loadLogs = false;
        base.StateHasChanged();

        var logs = await LIN.Access.Auth.Controllers.Account.LoginLogs(LIN.Access.Developer.Session.Instance.AccountToken);


        loadLogs = true;
        base.StateHasChanged();
        Logs = logs.Models;
        base.StateHasChanged();
    }

}

<div class="layoutMain">


    <h1 style="font-size: 35px" class="gilroy-bold">Historial de aplicaciones</h1>


    <div class="mt-10">


        @if (!loadLogs)
        {
            <div class="flex items-center justify-center mt-3">
                <CircleLoader></CircleLoader>
            </div>

        }
        else
        {
            <ol class="relative border-l border-gray-200 dark:border-gray-700">


                @foreach (var log in Logs)
                {
                    <li class="mb-10 ml-6">
                        <span class="absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900">
                            <img class="rounded-full shadow-lg" src="./img/apps.png" alt="app" />
                        </span>
                        <div class="items-center justify-between p-4 bg-white border border-gray-200 rounded-lg shadow-sm sm:flex dark:bg-gray-700 dark:border-gray-600">
                            <time class="mb-1 text-xs font-normal text-gray-400 sm:order-last sm:mb-0">@(log.Date.ToString("HH:mm  dd/MM/yyyy"))</time>
                            <div class="text-sm font-normal text-gray-500 dark:text-gray-300">Inicio sesión en <a class="font-semibold text-blue-600 hover:underline">@log.Application.Name</a> usando <span class="bg-gray-100 text-gray-800 text-xs font-normal mr-2 px-2.5 py-0.5 rounded dark:bg-gray-600 dark:text-gray-300">Credenciales</span></div>
                        </div>
                    </li>
                }


            </ol>
        }

    </div>


</div>